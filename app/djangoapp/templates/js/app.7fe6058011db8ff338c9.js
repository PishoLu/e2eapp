webpackJsonp([1],{"09yM":function(e,t){},"73Q8":function(e,t){},EbL6:function(e,t){},JLih:function(e,t){},NHnr:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i("7+uW"),s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var a=i("VU/8")({name:"App"},s,!1,function(e){i("JLih")},null,null).exports,n=i("/ocq"),o=i("Xxa5"),l=i.n(o),d=i("exGp"),u=i.n(d),c=i("Muz9"),m=i.n(c);m.a.defaults.withCredentials=!0;var p={name:"friend",data:function(){return{count:20,message_loading:!1,loading:!1,logining_userid:0,message_list:[],search_input:"",msg_input:"",dialogFormVisible:!1,friendsList:[{id:8,userid:18138754,username:"usertest_not_friend",remark:"",status:0},{id:8,userid:18138755,username:"usertest_not_friend2",remark:"",status:0},{id:8,userid:18138754,username:"usertest1",remark:"",status:1}],search_result:[],current_obj_id:0,is_friend:0,csrftoken:"",res_data:{},not_firend_active:0,temp_fromUserid:0}},created:function(){this.logining_userid=this.$cookies.get("logining_userid"),this.logining_userid?this.friendsList_flash():this.$router.push("/login")},computed:{},methods:{send_message:function(){var e=this;return u()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.message_get();case 2:m.a.get("http://localhost:8000/apis/friendsList/"+e.current_obj_id).then(function(t){1===t.data.code?m.a.post("http://localhost:8000/apis/encryptMessage/",{plaintext:e.msg_input,toUserid:e.current_obj_id}).then(function(t){1===t.data.code?(e.res_data=t.data.data,m.a.post("http://127.0.0.1:8888/apis/message/",{fromUserid:e.res_data.fromUserid,toUserid:e.res_data.toUserid,ciphertext:e.res_data.message}).then(function(t){1===t.data.code?m.a.post("http://localhost:8000/apis/storeMessage/",{fromUserid:e.res_data.fromUserid,toUserid:e.res_data.toUserid,kdf_next:e.res_data.kdf_next,EphemeralPub:e.res_data.message.EphemeralPub,plaintext:e.res_data.plaintext}).then(function(t){1===t.data.code?e.message_list_flash():e.$notify.error({title:"储存消息到本地失败。",message:"请重新发送消息。"})}):e.$notify.error({title:"上传消息到服务器失败。",message:"请重新发送消息。"})})):e.$notify.error({title:"本地加密失败。",message:"请重新发送消息。"}),e.msg_input=""}):m.a.get("http://127.0.0.1:8888/apis/user/"+id).then(function(e){if(1===e.data.code){var t=e.data.data;m.a.post("http://localhost:8000/apis/storeFriend/",{userid:t.userid,username:t.username,remark:"",status:1,IdentityPub:t.IdentityPub,SignedPub:t.SignedPub,OneTimePub:t.OneTimePub,EphemeralPub:t.EphemeralPub})}}).then(function(t){e.$notify.error({title:"已添加好友信息到数据库",message:"请重新输入。"})})});case 3:case"end":return t.stop()}},t,e)}))()},message_get:function(){var e=this;this.message_loading=!0,m.a.get("http://127.0.0.1:8888/apis/message/").then(function(t){if(1===t.data.code){get_data=t.data.data;for(var i=0;i<get_data.length;i++)e.temp_fromUserid=get_data[i][fromUserid],m.a.get("http://localhost:8000/apis/friendsList"+int(temp_fromUserid)).then(function(t){1===t.data.code||m.a.get("http://127.0.0.1:8888/user/"+int(temp_fromUserid)).then(function(t){if(1===t.data.code){var i=t.data.data;m.a.post("http://localhost:8000/apis/sotre_friend/",{userid:i.userid,username:i.username,remark:"",status:0,IdentityPub:i.IdentityPub,SignedPub:i.SignedPub,OneTimePub:i.OneTimePub,EphemeralPub:i.EphemeralPub}).then(function(t){1===t.data.code?e.$notify({title:"待定好友添加成功",type:"success"}):e.$notify.error({title:"待定好友添加失败。",message:"请重新获取。"})})}else e.$notify.error({title:"获取服务器记录失败。",message:"请重新获取。"})})});for(i=0;i<post_data.length;i++);}else e.$notify.error({title:"获取服务器记录失败。",message:"请重新获取。"})})},excheng_obj:function(e){this.current_obj_id=e,this.not_firend_active=0,this.message_list_flash()},message_list_flash:function(){var e=this;m.a.get("http://localhost:8000/apis/filterMessages/"+this.current_obj_id,{headers:{}}).then(function(t){1===t.data.code?e.message_list=t.data.data:e.$notify.error({title:"获取历史记录失败，或者记录为空。",message:"刷新一下。"})})},search_friend:function(){var e=this;this.search_result=[],m.a.get("http://127.0.0.1:8888/apis/user/"+this.search_input).then(function(t){if(1===t.data.code){e.search_result.push(t.data.data),e.search_result[0].userid===parseInt(e.logining_userid)?e.is_friend=2:e.is_friend=0;for(var i=0;i<e.friendsList.length;i++)e.friendsList[i].userid===e.search_result[0].userid?e.is_friend=1:e.is_friend=0}else e.$notify.error({title:"搜索失败！",message:"请稍后重试。"})}),this.dialogFormVisible=!0},friendsList_flash:function(){var e=this;m.a.get("http://localhost:8000/apis/friendsList/",{headers:{}}).then(function(t){1===t.data.code?e.friendsList=t.data.data:e.$notify.error({title:"获取好友列表失败，或者好友列表为空。",message:"重启一下应用看看？"})})},show_friend_option:function(e){this.not_firend_active=e,this.current_obj_id=0},add_friend:function(e){var t=this;m.a.post("http://localhost:8000/apis/storeFriend/",{userid:e.userid,username:e.username,remark:"",status:1,IdentityPub:e.IdentityPub,SignedPub:e.SignedPub,OneTimePub:e.OneTimePub,EphemeralPub:e.EphemeralPub,headers:{}}).then(function(e){1===e.data.code?(t.dialogFormVisible=!1,t.$notify({title:"添加成功！",message:"已将好友添加到列表。",type:"success"}),t.friendsList_flash()):(t.dialogFormVisible=!1,t.$notify.error({title:"添加失败！",message:"请稍后重试。"}))})}},update_friend:function(e){var t=this;m.a.put("http://localhost:8000/apis/storeFriend/",{userid:e}).then(function(e){1===e.data.code?t.$notify({title:"添加成功！",type:"success"}):t.$notify.error({title:"添加失败！",message:"请稍后重试。"})})},delete_friend:function(e){var t=this;m.a.delete("http://localhost:8000/apis/storeFriend/",{userid:e}).then(function(e){1===e.data.code?t.$notify({title:"删除成功！",type:"success"}):t.$notify.error({title:"删除失败！",message:"请稍后重试。"})})},watch:{current_obj_id:function(e,t){}}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"app"}},[i("el-dialog",{attrs:{title:"搜索结果",visible:e.dialogFormVisible,"modal-append-to-body":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[e.search_result.length?i("el-row",[i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_title"},[e._v("ID")])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_title"},[e._v("Username")])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_title"})])],1):i("el-row",[i("el-col",{attrs:{span:24}},[i("div",{staticClass:"search_table_title"},[e._v("没有该用户相关信息")])])],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:24}},[i("el-divider")],1)],1),e._v(" "),e._l(e.search_result,function(t,r){return i("el-row",{key:r},[i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_itme"},[e._v(e._s(t.userid))])]),e._v(" "),i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_itme"},[e._v(e._s(t.username))])]),e._v(" "),1===e.is_friend?i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_itme"},[i("el-button",{attrs:{type:"primary",disabled:""}},[e._v("已经是好友了")])],1)]):2===e.is_friend?i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_itme"},[i("el-button",{attrs:{type:"primary",disabled:""}},[e._v("不能添加自己哦")])],1)]):i("el-col",{attrs:{span:8}},[i("div",{staticClass:"search_table_itme"},[i("el-button",{attrs:{type:"primary"},on:{click:function(i){return e.add_friend(t)}}},[e._v("添加")])],1)]),e._v(" "),i("el-col",{attrs:{span:24}},[i("el-divider")],1)],1)})],2),e._v(" "),i("div",{attrs:{id:"left"}},[i("div",{staticClass:".col-md-3",attrs:{id:"search_line"}},[i("el-input",{attrs:{placeholder:"请输入内容",required:"required",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search_friend(t)}},model:{value:e.search_input,callback:function(t){e.search_input=t},expression:"search_input"}})],1),e._v(" "),i("div",{attrs:{id:"friendsList"}},[i("el-row",{staticClass:"tac"},[i("el-col",{attrs:{span:24}},[i("el-menu",{staticClass:"el-menu",attrs:{"default-active":"1","default-open":"1","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},e._l(e.friendsList,function(t,r){return i("el-menu-item-group",{key:r},[t.status?i("el-menu-item",{staticClass:"friend-item",on:{click:function(i){return e.excheng_obj(t.userid)}}},[e._v(e._s(t.username)+"\n              ")]):e.not_firend_active===t.userid&&0===t.status?i("el-menu-item",{staticClass:"friend-item",on:{click:function(i){return e.show_friend_option(t.userid)}}},[i("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:""},on:{click:function(i){return e.update_friend(t.userid)}}}),e._v(" "),i("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(i){return e.delete_friend(t.userid)}}})],1):e.not_friend_active!==t.userid?i("el-menu-item",{staticClass:"friend-item",on:{click:function(i){return e.show_friend_option(t.userid)}}},[e._v(e._s(t.username)+"\n              ")]):e._e()],1)}),1)],1)],1)],1)]),e._v(" "),i("div",{attrs:{id:"right"}},[e.current_obj_id?i("div",{attrs:{id:"show_window"}},[i("div",{attrs:{id:"show_message"}},[i("el-row",[i("el-col",{attrs:{span:24}},[i("div",[e.message_loading?i("el-button",{attrs:{icon:"el-icon-loading",id:"message_get_button"}}):i("el-button",{attrs:{icon:"el-icon-refresh-left",id:"message_get_button"},on:{click:function(t){return e.message_get()}}})],1)])],1),e._v(" "),e._l(e.message_list,function(t,r){return i("el-row",{key:r},[1===t.fromUserid?i("el-col",{attrs:{span:24}},[i("div",{staticClass:"show_message_date_self"},[e._v(e._s(t.date))])]):i("el-col",{attrs:{span:24}},[i("div",{staticClass:"show_message_date"},[e._v(e._s(t.date))])]),e._v(" "),1===t.fromUserid?i("el-col",{attrs:{span:24}},[i("div",{staticClass:"show_message_text_self"},[e._v(e._s(t.plaintext))])]):i("el-col",{attrs:{span:24}},[i("div",{staticClass:"show_message_text"},[e._v(e._s(t.plaintext))])])],1)})],2),e._v(" "),i("div",{attrs:{id:"input_box"}},[i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.msg_input,expression:"msg_input"}],attrs:{id:"textarea_box",name:"",cols:"50",placeholder:"在这里输入",autofocus:"",required:"required"},domProps:{value:e.msg_input},on:{input:function(t){t.target.composing||(e.msg_input=t.target.value)}}}),e._v(" "),i("div",{attrs:{id:"submit_button"}},[i("el-button",{attrs:{type:"primary",id:"button"},on:{click:function(t){return e.send_message()}}},[e._v("发送")])],1)])]):e._e()])],1)},staticRenderFns:[]};var g=i("VU/8")(p,f,!1,function(e){i("EbL6")},"data-v-0883a56f",null).exports,_=i("e9Q/"),h=i.n(_);var b={data:function(){return{dialogFormVisible:!1,isreg:0,FormLogin:{userid:"",password:""},FormReg:{username:"",password:"",IdentityPub:"",SignedPub:"",OneTimePub:"",EphemeralPub:"",IdentityPri:"",SignedPri:"",OneTimePri:"",EphemeralPri:""},FormPrikey:{IdentityPri:"",SignedPri:"",OneTimePri:"",EphemeralPri:""},keys:{},csrftoken:""}},created:function(){this.$cookies.get("logining_userid")&&this.$router.push("/")},methods:{login:function(){this.isreg=0,this.FormReg.username="",this.FormReg.password="",this.FormLogin.userid="",this.FormLogin.password=""},regis:function(){this.isreg=1,this.FormLogin.userid="",this.FormLogin.password="",this.FormReg.username="",this.FormReg.password=""},Login:function(){var e=this;m.a.get("http://localhost:8000/apis/getUser/"+this.FormLogin.userid).then(function(t){1===t.data.code?void 0!==t.data.data[0].IdentityPri?m.a.post("http://127.0.0.1:8888/apis/user/"+e.FormLogin.userid,{password:h()(e.FormLogin.password),headers:{}}).then(function(t){1===t.data.code?(e.$cookies.set("logining_userid",t.data.data.userid),e.$cookies.set("SameSite","Lax"),e.$router.push("/")):e.$notify.error({title:"登录失败！",message:"请重新登录"})}):e.dialogFormVisible=!0:e.dialogFormVisible=!0})},updated_pri:function(){var e=this;this.dialogFormVisible=!1,m.a.post("http://localhost:8000/apis/checkPri/",{IdentityPri:this.FormPrikey.IdentityPri,SignedPri:this.FormPrikey.SignedPri,OneTimePri:this.FormPrikey.OneTimePri,EphemeralPri:this.FormPrikey.EphemeralPri,headers:{}}).then(function(t){1===t.data.code?(e.keys=t.data.data,m.a.get("http://127.0.0.1:8888/apis/user/"+e.FormLogin.userid).then(function(t){if(1===t.data.code){var i=t.data.data.username;m.a.post("http://localhost:8000/apis/storeUser",{userid:e.FormLogin.userid,username:i,IdentityPub:e.keys.IdentityPub,SignedPub:e.keys.SignedPub,OneTimePub:e.keys.OneTimePub,EphemeralPub:e.keys.EphemeralPub,IdentityPri:e.keys.IdentityPri,SignedPri:e.keys.SignedPri,OneTimePri:e.keys.OneTimePri,EphemeralPri:e.keys.EphemeralPri,headers:{}}).then(function(t){1===t.data.code?e.$notify({title:"已将当前用户添加到数据库",message:"请重新登录",type:"success"}):e.$notify.error({title:"保存用户密钥出错！",message:"请重新登录"})})}else e.$notify.error({title:"服务器获取用户信息失败！",message:"请重新登录"})})):e.$notify.error({title:"私钥格式有误！",message:"请重新登录"})})},Register:function(){var e=this;m.a.post("http://localhost:8000/apis/createNewKeyspair/",{headers:{}}).then(function(t){var i=t.data.data;e.FormReg.IdentityPub=i.IdentityPub,e.FormReg.SignedPub=i.SignedPub,e.FormReg.OneTimePub=i.OneTimePub,e.FormReg.EphemeralPub=i.EphemeralPub,e.FormReg.IdentityPri=i.IdentityPri,e.FormReg.SignedPri=i.SignedPri,e.FormReg.OneTimePri=i.OneTimePri,e.FormReg.EphemeralPri=i.EphemeralPri,m.a.post("http://127.0.0.1:8888/apis/user/",{username:e.FormReg.username,password:h()(e.FormReg.password),IdentityPub:e.FormReg.IdentityPub,SignedPub:e.FormReg.SignedPub,OneTimePub:e.FormReg.OneTimePub,EphemeralPub:e.FormReg.EphemeralPub,headers:{}}).then(function(t){if(t.data.code){var i=e.$createElement;e.$notify({title:"注册成功的ID:",message:i("i",{style:"color: teal"},t.data.data),type:"success",duration:0}),m.a.post("http://localhost:8000/apis/storeUser/",{userid:t.data.data,username:e.FormReg.username,IdentityPub:e.FormReg.IdentityPub,SignedPub:e.FormReg.SignedPub,OneTimePub:e.FormReg.OneTimePub,EphemeralPub:e.FormReg.EphemeralPub,IdentityPri:e.FormReg.IdentityPri,SignedPri:e.FormReg.SignedPri,OneTimePri:e.FormReg.OneTimePri,EphemeralPri:e.FormReg.EphemeralPri,headers:{}}),e.isreg=0,e.FormLogin.userid="",e.FormLogin.password="",e.FormReg.username="",e.FormReg.password=""}else e.$notify.error({title:"注册失败！",message:"请重新注册"})})})}}},v={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"login-container"},[i("el-dialog",{attrs:{title:"没有私钥信息，请输入私钥信息！",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[i("el-form",{attrs:{model:e.FormPrikey}},[i("el-form-item",{attrs:{label:"IdentityPri"}},[i("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.FormPrikey.IdentityPri,callback:function(t){e.$set(e.FormPrikey,"IdentityPri",t)},expression:"FormPrikey.IdentityPri"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"SignedPri"}},[i("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.FormPrikey.SignedPri,callback:function(t){e.$set(e.FormPrikey,"SignedPri",t)},expression:"FormPrikey.SignedPri"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"OneTimePri"}},[i("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.FormPrikey.OneTimePri,callback:function(t){e.$set(e.FormPrikey,"OneTimePri",t)},expression:"FormPrikey.OneTimePri"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"EphemeralPri"}},[i("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.FormPrikey.EphemeralPri,callback:function(t){e.$set(e.FormPrikey,"EphemeralPri",t)},expression:"FormPrikey.EphemeralPri"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updated_pri()}}},[e._v("确 定")])],1)],1),e._v(" "),e.isreg?i("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm login-page",attrs:{model:e.FormReg,"status-icon":"","label-position":"left","label-width":"0px"}},[i("el-button",{staticClass:"login-button-left",attrs:{type:"primary"},on:{click:e.login}},[e._v("登录")]),e._v(" "),i("el-button",{staticClass:"login-button-right",attrs:{type:"primary"},on:{click:e.regis}},[e._v("注册")]),e._v(" "),i("el-form-item",{attrs:{prop:"username"}},[i("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"用户名",required:"required"},model:{value:e.FormReg.username,callback:function(t){e.$set(e.FormReg,"username",t)},expression:"FormReg.username"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"password"}},[i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码",required:"required"},model:{value:e.FormReg.password,callback:function(t){e.$set(e.FormReg,"password",t)},expression:"FormReg.password"}})],1),e._v(" "),i("el-form-item",{staticStyle:{width:"100%"}},[i("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.Register}},[e._v("注册")])],1)],1):i("el-form",{ref:"ruleForm2",staticClass:"demo-ruleForm login-page",attrs:{model:e.FormLogin,"status-icon":"","label-position":"left","label-width":"0px"}},[i("el-button",{staticClass:"login-button-left",attrs:{type:"primary"},nativeOn:{click:function(t){return e.login(t)}}},[e._v("登录")]),e._v(" "),i("el-button",{staticClass:"login-button-right",attrs:{type:"primary"},nativeOn:{click:function(t){return e.regis(t)}}},[e._v("注册")]),e._v(" "),i("el-form-item",{attrs:{prop:"userid"}},[i("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"请使用注册成功的ID登录",required:"required"},model:{value:e.FormLogin.userid,callback:function(t){e.$set(e.FormLogin,"userid",t)},expression:"FormLogin.userid"}})],1),e._v(" "),i("el-form-item",{attrs:{prop:"password"}},[i("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码",required:"required"},model:{value:e.FormLogin.password,callback:function(t){e.$set(e.FormLogin,"password",t)},expression:"FormLogin.password"}})],1),e._v(" "),i("el-form-item",{staticStyle:{width:"100%"}},[i("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.Login}},[e._v("登录")])],1)],1)],1)},staticRenderFns:[]};var y=i("VU/8")(b,v,!1,function(e){i("73Q8")},"data-v-4459f733",null).exports;r.default.use(n.a);var P=new n.a({mode:"history",routes:[{path:"/",name:"Index",component:g},{path:"/login",name:"Login",component:y}]}),F=i("TcQY"),k=i.n(F),w=(i("09yM"),i("6Lj2")),$=i.n(w);r.default.use($.a),r.default.use(k.a),new r.default({el:"#app",router:P,components:{App:a},template:"<App/>"}),r.default.prototype.message_list_flash=function(){var e=this;axios.get("http://localhost:8000/apis/filter_messages/"+this.current_obj_id,{headers:{}}).then(function(t){1===t.data.code?e.message_list=t.data.data:e.$notify.error({title:"获取历史记录失败。",message:"刷新一下。"})})},r.default.prototype.friends_list_flash=function(){var e=this;axios.get("http://localhost:8000/apis/friends_list/",{headers:{}}).then(function(t){1===t.data.code?e.friends_list=t.data.data:e.$notify.error({title:"获取好友列表失败，或者好友列表为空。",message:"重启一下应用看看？"})})}}},["NHnr"]);
//# sourceMappingURL=app.7fe6058011db8ff338c9.js.map