webpackJsonp([1],{"09yM":function(e,t){},JLih:function(e,t){},NHnr:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r("7+uW"),s={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var a=r("VU/8")({name:"App"},s,!1,function(e){r("JLih")},null,null).exports,n=r("/ocq"),o=r("Xxa5"),l=r.n(o),d=r("exGp"),u=r.n(d),m=r("Muz9"),c=r.n(m),f={name:"friend",data:function(){return{count:20,messageLoading:!1,loginingUserid:0,messageList:[],formSearch:{searchInput:""},formMsg:{msgInput:""},dialogFormVisible:!1,friendsList:[],searchResult:[],currentObjID:0,isFriend:0,csrftoken:"",resData:{},notFriendActive:0,tempFromUserid:0,formMsgRule:{msgInput:[{required:!0,message:"发送内容不能为空",trigger:"blur"}]},textareaLines:20}},created:function(){c.a.defaults.withCredentials=!0,this.loginingUserid=this.$cookies.get("loginingUserid"),this.loginingUserid?this.friendsListFlash():this.$router.push("/login")},computed:{},methods:{sendMessage:function(e){var t=this;return u()(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.$refs.formMsg.validate(function(e){if(!e)return!1;c.a.get("http://localhost:8000/apis/friendsList/"+t.currentObjID).then(function(e){1===e.data.code?c.a.post("http://localhost:8000/apis/encryptMessage/",{plaintext:t.formMsg.msgInput,toUserid:t.currentObjID}).then(function(e){1===e.data.code?(t.resData=e.data.data,c.a.post("http://127.0.0.1:8888/apis/message/",{fromUserid:t.resData.fromUserid,toUserid:t.resData.toUserid,message:t.resData.message}).then(function(e){1===e.data.code?c.a.post("http://localhost:8000/apis/storeMessage/",{fromUserid:t.resData.fromUserid,toUserid:t.resData.toUserid,kdf_next:t.resData.kdf_next,EphemeralPub:t.resData.message.EphemeralPub,EphemeralPri:t.resData.EphemeralPri,plaintext:t.resData.plaintext,belongUserid:t.loginingUserid}).then(function(e){1===e.data.code?t.messageListFlash():t.$notify.error({title:"储存消息到本地失败。",message:"请重新发送消息。"})}):t.$notify.error({title:"上传消息到服务器失败。",message:"请重新发送消息。"})})):t.$notify.error({title:"本地加密失败。",message:"请重新发送消息。"}),t.formMsg.msgInput=""}):c.a.get("http://127.0.0.1:8888/apis/user/"+id).then(function(e){if(1===e.data.code){var t=e.data.data;c.a.post("http://localhost:8000/apis/storeFriend/",{userid:t.userid,username:t.username,remark:"",status:1,IdentityPub:t.IdentityPub,SignedPub:t.SignedPub,OneTimePub:t.OneTimePub,EphemeralPub:t.EphemeralPub})}}).then(function(e){t.$notify.error({title:"已添加好友信息到数据库",message:"请重新输入。"})})})});case 1:case"end":return e.stop()}},e,t)}))()},messageGet:function(){var e=this;this.messageLoading=!0,c.a.get("http://127.0.0.1:8888/apis/message/").then(function(t){if(1===t.data.code){var r=t.data.data;console.log(r);for(var i=0;i<r.length;i++)e.tempFromUserid=r[i][fromUserid],c.a.get("http://localhost:8000/apis/friendsList"+int(tempFromUserid)).then(function(t){1===t.data.code||c.a.get("http://127.0.0.1:8888/user/"+int(tempFromUserid)).then(function(t){if(1===t.data.code){var r=t.data.data;c.a.post("http://localhost:8000/apis/sotre_friend/",{userid:r.userid,username:r.username,remark:"",status:0,IdentityPub:r.IdentityPub,SignedPub:r.SignedPub,OneTimePub:r.OneTimePub,EphemeralPub:r.EphemeralPub}).then(function(t){1===t.data.code?e.$notify({title:"待定好友添加成功",type:"success"}):e.$notify.error({title:"待定好友添加失败。",message:"请重新获取。"})})}else e.$notify.error({title:"获取服务器记录失败。",message:"请重新获取。"})})});for(i=0;i<r.length;i++)c.a.post("http://localhost:8000/apis/decryptMessage/",{fromUserid:r.fromUserid,toUserid:r.toUserid,date:r.date,message:r.message}).then(function(e){});e.messageLoading=!1}else e.$notify.error({title:"获取服务器记录失败。",message:"请重新获取。"}),e.messageLoading=!1})},exchengObj:function(e){this.currentObjID=e,this.notFriendActive=0,this.messageListFlash()},messageListFlash:function(){var e=this;c.a.get("http://localhost:8000/apis/filterMessages/"+this.currentObjID,{headers:{}}).then(function(t){1===t.data.code?(console.log(t.data),e.messageList=t.data.data):e.$notify.error({title:"获取历史记录失败，或者记录为空。",message:"刷新一下。"})})},searchFriend:function(e){var t=this;this.searchResult=[],c.a.get("http://127.0.0.1:8888/apis/user/"+this.formSearch.searchInput).then(function(e){if(1===e.data.code){t.searchResult.push(e.data.data);for(var r=0;r<t.friendsList.length;r++)t.friendsList[r].userid===t.searchResult[0].userid?t.isFriend=1:t.searchResult[0].userid===parseInt(t.loginingUserid)?t.isFriend=2:t.isFriend=0}else t.$notify.error({title:"搜索失败！",message:"请稍后重试。"})}),this.dialogFormVisible=!0},friendsListFlash:function(){var e=this;c.a.get("http://localhost:8000/apis/friendsList/",{headers:{}}).then(function(t){1===t.data.code?e.friendsList=t.data.data:e.$notify.error({title:"获取好友列表失败，或者好友列表为空。",message:"重启一下应用看看？"})})},showFriendOption:function(e){this.notFriendActive=e,this.currentObjID=0},addFriend:function(e){var t=this;c.a.post("http://localhost:8000/apis/storeFriend/",{userid:e.userid,username:e.username,remark:"",status:1,IdentityPub:e.IdentityPub,SignedPub:e.SignedPub,OneTimePub:e.OneTimePub,EphemeralPub:e.EphemeralPub,headers:{}}).then(function(e){1===e.data.code?(t.dialogFormVisible=!1,t.$notify({title:"添加成功！",message:"已将好友添加到列表。",type:"success"}),t.friendsListFlash()):(t.dialogFormVisible=!1,t.$notify.error({title:"添加失败！",message:"请稍后重试。"}))})}},updateFriend:function(e){var t=this;c.a.put("http://localhost:8000/apis/storeFriend/",{userid:e}).then(function(e){1===e.data.code?t.$notify({title:"添加成功！",type:"success"}):t.$notify.error({title:"添加失败！",message:"请稍后重试。"})})},deleteFriend:function(e){var t=this;c.a.delete("http://localhost:8000/apis/storeFriend/",{userid:e}).then(function(e){1===e.data.code?t.$notify({title:"删除成功！",type:"success"}):t.$notify.error({title:"删除失败！",message:"请稍后重试。"})})},watch:{currentObjID:function(e,t){}}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"app"}},[r("el-dialog",{attrs:{title:"搜索结果",visible:e.dialogFormVisible,"modal-append-to-body":!1},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[e.searchResult.length?r("el-row",[r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_title"},[e._v("ID")])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_title"},[e._v("Username")])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_title"})])],1):r("el-row",[r("el-col",{attrs:{span:24}},[r("div",{staticClass:"search_table_title"},[e._v("没有该用户相关信息")])])],1),e._v(" "),r("el-row",[r("el-col",{attrs:{span:24}},[r("el-divider")],1)],1),e._v(" "),e._l(e.searchResult,function(t,i){return r("el-row",{key:i},[r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_itme"},[e._v(e._s(t.userid))])]),e._v(" "),r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_itme"},[e._v(e._s(t.username))])]),e._v(" "),1===e.isFriend?r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_itme"},[r("el-button",{attrs:{type:"primary",disabled:""}},[e._v("已经是好友了")])],1)]):2===e.isFriend?r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_itme"},[r("el-button",{attrs:{type:"primary",disabled:""}},[e._v("不能添加自己哦")])],1)]):r("el-col",{attrs:{span:8}},[r("div",{staticClass:"search_table_itme"},[r("el-button",{attrs:{type:"primary"},on:{click:function(r){return e.addFriend(t)}}},[e._v("添加")])],1)]),e._v(" "),r("el-col",{attrs:{span:24}},[r("el-divider")],1)],1)})],2),e._v(" "),r("div",{attrs:{id:"left"}},[r("div",{staticClass:".col-md-3",attrs:{id:"search_line"}},[r("el-input",{attrs:{placeholder:"请输入内容",required:"required",clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchFriend("formSearch")}},model:{value:e.formSearch.searchInput,callback:function(t){e.$set(e.formSearch,"searchInput",t)},expression:"formSearch.searchInput"}})],1),e._v(" "),r("div",{attrs:{id:"friendsList"}},[r("el-row",{staticClass:"tac"},[r("el-col",{attrs:{span:24}},[r("el-menu",{staticClass:"el-menu",attrs:{"default-active":"1","default-open":"1","background-color":"#545c64","text-color":"#fff","active-text-color":"#ffd04b"}},e._l(e.friendsList,function(t,i){return r("el-menu-item-group",{key:i},[t.status?r("el-menu-item",{staticClass:"friend-item",on:{click:function(r){return e.exchengObj(t.userid)}}},[e._v(e._s(t.username)+"\n              ")]):e.notFriendActive===t.userid&&0===t.status?r("el-menu-item",{staticClass:"friend-item",on:{click:function(r){return e.showFriendOption(t.userid)}}},[r("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:""},on:{click:function(r){return e.updateFriend(t.userid)}}}),e._v(" "),r("el-button",{attrs:{type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(r){return e.deleteFriend(t.userid)}}})],1):e.notFriendActive!==t.userid?r("el-menu-item",{staticClass:"friend-item",on:{click:function(r){return e.showFriendOption(t.userid)}}},[e._v(e._s(t.username)+"\n              ")]):e._e()],1)}),1)],1)],1)],1)]),e._v(" "),r("div",{attrs:{id:"right"}},[e.currentObjID?r("div",{attrs:{id:"show_window"}},[r("div",{attrs:{id:"show_message"}},[r("el-row",[r("el-col",{attrs:{span:24}},[r("div",[e.messageLoading?r("el-button",{attrs:{icon:"el-icon-loading",id:"message_get_button"}}):r("el-button",{attrs:{icon:"el-icon-refresh-left",id:"message_get_button"},on:{click:function(t){return e.messageGet()}}})],1)])],1),e._v(" "),e._l(e.messageList,function(t,i){return r("el-row",{key:i},[1===t.fromUserid?r("el-col",{attrs:{span:24}},[r("div",{staticClass:"show_message_date_self"},[e._v(e._s(t.date))])]):r("el-col",{attrs:{span:24}},[r("div",{staticClass:"show_message_date"},[e._v(e._s(t.date))])]),e._v(" "),1===t.fromUserid?r("el-col",{attrs:{span:24}},[r("div",{staticClass:"show_message_text_self"},[e._v(e._s(t.plaintext))])]):r("el-col",{attrs:{span:24}},[r("div",{staticClass:"show_message_text"},[e._v(e._s(t.plaintext))])])],1)})],2),e._v(" "),r("div",{attrs:{id:"input_box"}},[r("el-form",{ref:"formMsg",attrs:{rules:e.formMsgRule,id:"textarea_form",model:e.formMsg}},[r("textarea",{directives:[{name:"model",rawName:"v-model",value:e.formMsg.msgInput,expression:"formMsg.msgInput"}],attrs:{id:"textarea_box",placeholder:"在这里输入"},domProps:{value:e.formMsg.msgInput},on:{input:function(t){t.target.composing||e.$set(e.formMsg,"msgInput",t.target.value)}}}),e._v(" "),r("div",{attrs:{id:"submit_button"}},[r("el-button",{attrs:{type:"primary",id:"button"},on:{click:function(t){return e.sendMessage("formMsg")}}},[e._v("发送\n            ")])],1)])],1)]):e._e()])],1)},staticRenderFns:[]};var g=r("VU/8")(f,p,!1,function(e){r("vycl")},"data-v-2b3a8e1e",null).exports,h=r("e9Q/"),b=r.n(h);function v(e,t,r){""==t||void 0==t||null==t?r():/^[_a-zA-Z0-9]+$/.test(t)?r():r(new Error("仅由英文字母，数字以及下划线组成"))}var P={data:function(){return{dialogFormVisible:!1,isreg:0,formLogin:{userid:"",password:""},formLoginRule:{userid:[{required:!0,message:"请输入用户id",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},formRegRule:{username:[{required:!0,message:"请输入不包含空格符的英文字符串",trigger:"blur"},{validator:v,trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}]},formReg:{username:"",password:"",IdentityPub:"",SignedPub:"",OneTimePub:"",EphemeralPub:"",IdentityPri:"",SignedPri:"",OneTimePri:"",EphemeralPri:""},formPrikey:{IdentityPri:"",SignedPri:"",OneTimePri:"",EphemeralPri:""},keys:{},csrftoken:""}},created:function(){this.$cookies.get("loginingUserid")&&this.$router.push("/")},methods:{changeLogin:function(){this.isreg=0,this.formReg.username="",this.formReg.password="",this.formLogin.userid="",this.formLogin.password=""},changeRegis:function(){this.isreg=1,this.formLogin.userid="",this.formLogin.password="",this.formReg.username="",this.formReg.password=""},Login:function(e){var t=this;this.$refs.formLogin.validate(function(e){if(!e)return!1;c.a.get("http://localhost:8000/apis/getUser/"+t.formLogin.userid).then(function(e){1===e.data.code?void 0!==e.data.data[0].IdentityPri?c.a.post("http://127.0.0.1:8888/apis/user/"+t.formLogin.userid,{password:b()(t.formLogin.password),headers:{}}).then(function(e){1===e.data.code?(t.$cookies.set("loginingUserid",e.data.data.userid),t.$router.push("/")):t.$notify.error({title:"登录失败！",message:"请重新登录"})}):t.dialogFormVisible=!0:t.dialogFormVisible=!0})})},updatedPri:function(){var e=this;this.dialogFormVisible=!1,c.a.post("http://localhost:8000/apis/checkPri/",{IdentityPri:this.formPrikey.IdentityPri,SignedPri:this.formPrikey.SignedPri,OneTimePri:this.formPrikey.OneTimePri,EphemeralPri:this.formPrikey.EphemeralPri,headers:{}}).then(function(t){console.log(t),1===t.data.code?(e.keys=t.data.data,c.a.get("http://127.0.0.1:8888/apis/user/"+e.formLogin.userid).then(function(t){if(1===t.data.code){var r=t.data.data.username;c.a.post("http://localhost:8000/apis/storeUser",{userid:e.formLogin.userid,username:r,IdentityPub:e.keys.IdentityPub,SignedPub:e.keys.SignedPub,OneTimePub:e.keys.OneTimePub,EphemeralPub:e.keys.EphemeralPub,IdentityPri:e.keys.IdentityPri,SignedPri:e.keys.SignedPri,OneTimePri:e.keys.OneTimePri,EphemeralPri:e.keys.EphemeralPri,headers:{}}).then(function(t){1===t.data.code?e.$notify({title:"已将当前用户添加到数据库",message:"请重新登录",type:"success"}):e.$notify.error({title:"保存用户密钥出错！",message:"请重新登录"})})}else e.$notify.error({title:"服务器获取用户信息失败！",message:"请重新登录"})})):e.$notify.error({title:"私钥格式有误！",message:"请重新登录"})})},Register:function(e){var t=this;this.$refs.formReg.validate(function(e){if(!e)return!1;c.a.post("http://localhost:8000/apis/createNewKeyspair/",{headers:{}}).then(function(e){var r=e.data.data;t.formReg.IdentityPub=r.IdentityPub,t.formReg.SignedPub=r.SignedPub,t.formReg.OneTimePub=r.OneTimePub,t.formReg.EphemeralPub=r.EphemeralPub,t.formReg.IdentityPri=r.IdentityPri,t.formReg.SignedPri=r.SignedPri,t.formReg.OneTimePri=r.OneTimePri,t.formReg.EphemeralPri=r.EphemeralPri,c.a.post("http://127.0.0.1:8888/apis/user/",{username:t.formReg.username,password:b()(t.formReg.password),IdentityPub:t.formReg.IdentityPub,SignedPub:t.formReg.SignedPub,OneTimePub:t.formReg.OneTimePub,EphemeralPub:t.formReg.EphemeralPub,headers:{}}).then(function(e){if(e.data.code){var r=t.$createElement;t.$notify({title:"注册成功的ID:",message:r("i",{style:"color: teal"},e.data.data),type:"success",duration:0}),c.a.post("http://localhost:8000/apis/storeUser/",{userid:e.data.data,username:t.formReg.username,IdentityPub:t.formReg.IdentityPub,SignedPub:t.formReg.SignedPub,OneTimePub:t.formReg.OneTimePub,EphemeralPub:t.formReg.EphemeralPub,IdentityPri:t.formReg.IdentityPri,SignedPri:t.formReg.SignedPri,OneTimePri:t.formReg.OneTimePri,EphemeralPri:t.formReg.EphemeralPri,headers:{}}),t.isreg=0,t.formLogin.userid="",t.formLogin.password="",t.formReg.username="",t.formReg.password=""}else t.$notify.error({title:"注册失败！",message:"请重新注册"})})})})}}},y={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"login-container"},[r("el-dialog",{attrs:{title:"没有私钥信息，请输入私钥信息！",visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[r("el-form",{attrs:{model:e.formPrikey}},[r("el-form-item",{attrs:{label:"IdentityPri"}},[r("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.formPrikey.IdentityPri,callback:function(t){e.$set(e.formPrikey,"IdentityPri",t)},expression:"formPrikey.IdentityPri"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"SignedPri"}},[r("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.formPrikey.SignedPri,callback:function(t){e.$set(e.formPrikey,"SignedPri",t)},expression:"formPrikey.SignedPri"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"OneTimePri"}},[r("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.formPrikey.OneTimePri,callback:function(t){e.$set(e.formPrikey,"OneTimePri",t)},expression:"formPrikey.OneTimePri"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"EphemeralPri"}},[r("el-input",{attrs:{autocomplete:"off",required:"required"},model:{value:e.formPrikey.EphemeralPri,callback:function(t){e.$set(e.formPrikey,"EphemeralPri",t)},expression:"formPrikey.EphemeralPri"}})],1)],1),e._v(" "),r("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updatedPri()}}},[e._v("确 定")])],1)],1),e._v(" "),e.isreg?r("el-form",{ref:"formReg",staticClass:"demo-ruleForm login-page",attrs:{model:e.formReg,rules:e.formRegRule,"status-icon":"","label-position":"left","label-width":"0px"}},[r("el-button",{staticClass:"login-button-left",attrs:{type:"primary"},on:{click:function(t){return e.changeLogin()}}},[e._v("登录\n    ")]),e._v(" "),r("el-button",{staticClass:"login-button-right",attrs:{type:"primary"},on:{click:function(t){return e.changRregis()}}},[e._v("注册\n    ")]),e._v(" "),r("el-form-item",{attrs:{prop:"username"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"用户名"},model:{value:e.formReg.username,callback:function(t){e.$set(e.formReg,"username",t)},expression:"formReg.username"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码"},model:{value:e.formReg.password,callback:function(t){e.$set(e.formReg,"password",t)},expression:"formReg.password"}})],1),e._v(" "),r("el-form-item",{staticStyle:{width:"100%"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.Register("formReg")}}},[e._v("注册\n      ")])],1)],1):r("el-form",{ref:"formLogin",staticClass:"demo-ruleForm login-page",attrs:{model:e.formLogin,rules:e.formLoginRule,"status-icon":"","label-position":"left","label-width":"0px"}},[r("el-button",{staticClass:"login-button-left",attrs:{type:"primary"},nativeOn:{click:function(t){return e.changeLogin()}}},[e._v("登录\n    ")]),e._v(" "),r("el-button",{staticClass:"login-button-right",attrs:{type:"primary"},nativeOn:{click:function(t){return e.changeRegis()}}},[e._v("注册\n    ")]),e._v(" "),r("el-form-item",{attrs:{prop:"userid"}},[r("el-input",{attrs:{type:"text","auto-complete":"off",placeholder:"请使用注册成功的ID登录",required:"required"},model:{value:e.formLogin.userid,callback:function(t){e.$set(e.formLogin,"userid",t)},expression:"formLogin.userid"}})],1),e._v(" "),r("el-form-item",{attrs:{prop:"password"}},[r("el-input",{attrs:{type:"password","auto-complete":"off",placeholder:"密码",required:"required"},model:{value:e.formLogin.password,callback:function(t){e.$set(e.formLogin,"password",t)},expression:"formLogin.password"}})],1),e._v(" "),r("el-form-item",{staticStyle:{width:"100%"}},[r("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:function(t){return e.Login("formLogin")}}},[e._v("登录\n      ")])],1)],1)],1)},staticRenderFns:[]};var _=r("VU/8")(P,y,!1,function(e){r("VtHy")},"data-v-31ddb15f",null).exports;i.default.use(n.a);var k=new n.a({mode:"history",routes:[{path:"/",name:"Index",component:g},{path:"/login",name:"Login",component:_}]}),R=r("TcQY"),w=r.n(R),L=(r("09yM"),r("6Lj2")),I=r.n(L);i.default.use(I.a),i.default.use(w.a),new i.default({el:"#app",router:k,components:{App:a},template:"<App/>"})},VtHy:function(e,t){},vycl:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.e04ca98dd873e21cbd9b.js.map